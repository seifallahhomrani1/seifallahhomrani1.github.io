<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Seif-Allah's Blog" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Seif-Allah's Blog" /> <title> Lord Of SQLi : gremlin Writeup - Seif-Allah's Blog </title> <link rel="alternate" href="http://localhost:4000/LOS-gremlin/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/LOS-gremlin/" /> <meta name="description" content="&#39;Lord of SQL Injection&#39;, a site where you can learn about SQL injection vulnerabilities while capturing dungeons&#39;" /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Lord Of SQLi : gremlin Writeup | Seif-Allah Homrani" /> <meta property="og:title" content="Lord Of SQLi : gremlin Writeup | Seif-Allah Homrani" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/LOS-gremlin/" /> <meta property="og:description" content="&#39;Lord of SQL Injection&#39;, a site where you can learn about SQL injection vulnerabilities while capturing dungeons&#39;" /> <meta property="og:image" content="http://localhost:4000/assets/images/writeups/los/sql1.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Lord Of SQLi : gremlin Writeup | seifallah1" /> <meta name="twitter:url" content="http://localhost:4000/LOS-gremlin/" /> <meta name="twitter:site" content="@seifallah1" /> <meta name="twitter:creator" content="@seifallah1" /> <meta name="twitter:description" content="&#39;Lord of SQL Injection&#39;, a site where you can learn about SQL injection vulnerabilities while capturing dungeons&#39;" /> <meta name="twitter:image" content="http://localhost:4000/assets/images/writeups/los/sql1.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Seif-Allah's Blog" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/about/">about</a></div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <h1 class="header-title" itemprop="headline">Lord Of SQLi : gremlin Writeup</h1> <div class="post-meta"> <time datetime="2021-01-03T00:00:00+01:00" itemprop="datePublished"> Jan 03, 2021 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Seif-Allah Homrani</span> </span> <time hidden datetime="" itemprop="dateModified"> Jan 03, 2021 </time> <span hidden itemprop="publisher" itemtype="Person">Seif-Allah Homrani</span> <span hidden itemprop="image">/assets/images/writeups/los/sql1.png</span> <span hidden itemprop="mainEntityOfPage"><p><br /></p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p><br /></p> <p><img src="/assets/images/writeups/los/sql1.png" style=" width: 100%; max-width: 600px; height: auto;" /></p> <p><strong>Resources :</strong> <a href="/databases/2020/11/24/SQL-Injection.html">SQL INJECTION - Introduction</a></p> <h3 id="introduction"> <a href="#introduction" class="anchor-head"></a> Introduction </h3> <p><a href="https://los.rubiya.kr/">‘Lord of SQL Injection’</a>, a site where you can learn about SQL injection vulnerabilities while capturing dungeons. LoS provides 49 stepwise SQLinjection challenges. Challenges are about SQLinjection at mysql, sqlite, mssql, mongodb, webapp what protected by WAF.</p> <ul> <li>Site origin Country : Korea</li> <li>Language : English</li> </ul> <h3 id="gremlin"> <a href="#gremlin" class="anchor-head"></a> Gremlin </h3> <p>Given a php code :</p> <hr /> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;?php</span>
  <span class="k">include</span> <span class="s2">"./config.php"</span><span class="p">;</span>
  <span class="nf">login_chk</span><span class="p">();</span>
  <span class="nv">$db</span> <span class="o">=</span> <span class="nf">dbconnect</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/prob|_|\.|\(\)/i'</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="n">id</span><span class="p">]))</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"No Hack ~_~"</span><span class="p">);</span> <span class="c1">// do not try to attack another table, database!</span>
  <span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/prob|_|\.|\(\)/i'</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="n">pw</span><span class="p">]))</span> <span class="k">exit</span><span class="p">(</span><span class="s2">"No Hack ~_~"</span><span class="p">);</span>
  <span class="nv">$query</span> <span class="o">=</span> <span class="s2">"select id from prob_gremlin where id='</span><span class="si">{</span><span class="nv">$_GET</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="si">}</span><span class="s2">' and pw='</span><span class="si">{</span><span class="nv">$_GET</span><span class="p">[</span><span class="n">pw</span><span class="p">]</span><span class="si">}</span><span class="s2">'"</span><span class="p">;</span>
  <span class="k">echo</span> <span class="s2">"&lt;hr&gt;query : &lt;strong&gt;</span><span class="si">{</span><span class="nv">$query</span><span class="si">}</span><span class="s2">&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;"</span><span class="p">;</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="o">@</span><span class="nf">mysqli_fetch_array</span><span class="p">(</span><span class="nf">mysqli_query</span><span class="p">(</span><span class="nv">$db</span><span class="p">,</span><span class="nv">$query</span><span class="p">));</span>
  <span class="k">if</span><span class="p">(</span><span class="nv">$result</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span> <span class="nf">solve</span><span class="p">(</span><span class="s2">"gremlin"</span><span class="p">);</span>
  <span class="nb">highlight_file</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">);</span>
<span class="cp">?&gt;</span> 
</code></pre></div></div><hr /> <h3 id="explanation"> <a href="#explanation" class="anchor-head"></a> Explanation </h3> <p>-&gt; <em>Challenge preparation</em> First of all, it includes this php file called <em>config.php</em>, then it checks if you are logged in or not. After that, it connect to the database.</p> <p>-&gt; <em>The fun begins</em> <a href="https://www.php.net/manual/en/function.preg-match.php">preg_match</a> is a php function that performs a regular expression match. If the provided regex found in the <em>id</em> or <em>pw</em> fields it exits with “No Hack ~_~” message?</p> <p>-&gt; <em>REGEX explanation</em> /prob|_|.|()/i <strong>1st Alternative prob</strong> prob matches the characters prob literally (case insensitive) <strong>2nd Alternative _</strong> _ matches the character _ literally (case insensitive) <strong>3rd Alternative .</strong> . matches the character . literally (case insensitive) <strong>4th Alternative ()</strong> ( matches the character ( literally (case insensitive) ) matches the character ) literally (case insensitive) <strong>Global pattern flags</strong> i modifier: insensitive. Case insensitive match (ignores case of [a-zA-Z])</p> <p>Then, with the provided <em>id</em> and <em>pw</em>, the SQL query is ready to be executed, and it is printed out using the following <em>echo</em>. Using the <a href="https://www.php.net/manual/en/mysqli-result.fetch-array.php">mysqli_fetch_array</a> function, which fetch a result row as an associative, a numeric array, or both.</p> <p>Finally, it checks if the id has a value, if it has, the challenge is solved !</p> <p>I just want to mention that the <em>id</em> and <em>pw</em> field are gonna be passed in the url like this : ?id= If you’ve read my article mentioned above, you can solve this challenge easily by closing the id field using an apostrophe then executing a condition that returns true as a result like 1=1. So the final result will be : ?id=’ OR 1=1 Then we need to comment out the <em>pw</em> field so we insert a double dash followed by a space (Black Space = %20 : URL encoding) or a hashtag(hashtag = %23 : URL encoding ) ?id=’ OR 1=1 –%20 So the final query will be :</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">id</span> <span class="k">from</span> <span class="n">prob_gremlin</span> <span class="k">where</span> <span class="n">id</span><span class="o">=</span><span class="s1">''</span> <span class="k">OR</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span> <span class="c1">-- ' and pw=''</span>
</code></pre></div></div> <p>GREMLIN CLEAR !</p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/control-statements/" > <div class="nav-arrow">Previous</div> <span class="post-title">Java - OOP Concepts</span> </a> <a class="post-nav-item post-nav-next" href="/LOS-goblin/"> <div class="nav-arrow">Next</div> <span class="post-title">Lord Of SQLi : goblin Writeup</span> </a> </nav> <footer class="footer"> Made by <a href="https://github.com/seifallahhomrani1" target="_blank" rel="noreferrer noopener" >Seif-Allah</a> <span class="footer_item">&copy; 2021</span> <small class="footer_copyright"> </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
