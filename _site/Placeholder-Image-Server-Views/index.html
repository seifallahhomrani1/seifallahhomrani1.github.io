<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Seif-Allah's Blog" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Seif-Allah's Blog" /> <title> Django - Placeholder Image Server : Views - Seif-Allah's Blog </title> <link rel="alternate" href="http://localhost:4000/Placeholder-Image-Server-Views/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/Placeholder-Image-Server-Views/" /> <meta name="description" content="Generating the placeholder image using Pillow and BytesIO modules" /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Django - Placeholder Image Server : Views | Seif-Allah Homrani" /> <meta property="og:title" content="Django - Placeholder Image Server : Views | Seif-Allah Homrani" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/Placeholder-Image-Server-Views/" /> <meta property="og:description" content="Generating the placeholder image using Pillow and BytesIO modules" /> <meta property="og:image" content="http://localhost:4000/assets/images/Django/stateless_web_app.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Django - Placeholder Image Server : Views | seifallah1" /> <meta name="twitter:url" content="http://localhost:4000/Placeholder-Image-Server-Views/" /> <meta name="twitter:site" content="@seifallah1" /> <meta name="twitter:creator" content="@seifallah1" /> <meta name="twitter:description" content="Generating the placeholder image using Pillow and BytesIO modules" /> <meta name="twitter:image" content="http://localhost:4000/assets/images/Django/stateless_web_app.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Seif-Allah's Blog" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/about/">about</a></div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#django">DJANGO</a>, <a class="tag" href="/tags/#placeholder">PLACEHOLDER</a>, <a class="tag" href="/tags/#view">VIEW</a>, <a class="tag" href="/tags/#python">PYTHON</a>, <a class="tag" href="/tags/#web">WEB</a>, <a class="tag" href="/tags/#coding">CODING</a>, <a class="tag" href="/tags/#first">FIRST</a>, <a class="tag" href="/tags/#tutorial">TUTORIAL</a> </span> </div> <h1 class="header-title" itemprop="headline">Django - Placeholder Image Server : Views</h1> <div class="post-meta"> <time datetime="2020-11-12T00:00:00+01:00" itemprop="datePublished"> Nov 12, 2020 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Seif-Allah Homrani</span> </span> <time hidden datetime="" itemprop="dateModified"> Nov 12, 2020 </time> <span hidden itemprop="publisher" itemtype="Person">Seif-Allah Homrani</span> <span hidden itemprop="image">/assets/images/Django/stateless_web_app.png</span> <span hidden itemprop="mainEntityOfPage"><p>Previous Post : <a href="/django/2020/11/04/placeholder_image_server.html">Placeholder Image Server : First Steps</a></p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p>Previous Post : <a href="/django/2020/11/04/placeholder_image_server.html">Placeholder Image Server : First Steps</a></p> <p>After configuring the url patterns, now we need to make the view.</p> <ol> <li> <p>Though the regular expression will ensure that the height and width consist of digits, they will be passed to the view as strings. The view will need to convert them and may also want to validate that they are a manageable size. We can easily do this by validating user input with <strong>Django Forms</strong>. Typically forms are used to validate POST an GET content, but they can also be used to validate particular values from the URL, and if the form isnâ€™t valid, the view will send an error response to the vlient using <em>HttpResponse</em> subclass : <em>HttpResponseBadRequest</em> and sends a 400 Bad Request response.</p> </li> <li> <p>After validating the height and width, now we need to generate the image using Pillow module (from PIL import Image) and convert it to bytes using <em>io</em> module (from io import BytesIO). Once the image has been validated, the view successfully returns the PNG image for the requested width an height.</p> </li> <li> <p>However, an all-black image, with no sizing information, is not a very stylish or useful placeholder. With <em>Pillow</em> we can add this text to the image using the <em>ImageDraw</em> module.</p> </li> </ol> <p>Here is the final result of <em>views.py</em> :</p><hr /> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span><span class="p">,</span><span class="n">HttpResponseBadRequest</span>
<span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageDraw</span>



<span class="k">class</span> <span class="nc">ImageForm</span><span class="p">(</span><span class="n">forms</span><span class="p">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">forms</span><span class="p">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">max_value</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">forms</span><span class="p">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">max_value</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image_format</span><span class="o">=</span><span class="s">'PNG'</span><span class="p">):</span>
        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">'height'</span><span class="p">]</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s">'width'</span><span class="p">]</span>

        <span class="c1">#generate a new image with RGB mode
</span>        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s">'RGB'</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">))</span>   

        <span class="c1">#Adding sizing information using Pillow     
</span>        <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="p">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1">#format is used to replace brackets with values
</span>        <span class="n">text</span> <span class="o">=</span> <span class="s">'{} X {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">)</span>
        <span class="n">textwidth</span><span class="p">,</span> <span class="n">textheight</span> <span class="o">=</span> <span class="n">draw</span><span class="p">.</span><span class="n">textsize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1">#test if the text fit well in the image, if not  we don't print it
</span>        <span class="k">if</span> <span class="n">textwidth</span> <span class="o">&lt;</span> <span class="n">width</span> <span class="ow">and</span> <span class="n">textheight</span> <span class="o">&lt;</span> <span class="n">height</span> <span class="p">:</span>
            <span class="n">texttop</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="n">textheight</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">textleft</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">textwidth</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">draw</span><span class="p">.</span><span class="n">text</span><span class="p">((</span><span class="n">textleft</span><span class="p">,</span><span class="n">texttop</span><span class="p">),</span><span class="n">text</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">))</span>


        <span class="c1">#converting the image into bytes
</span>        <span class="n">content</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">image</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">image_format</span><span class="p">)</span>
        <span class="n">content</span><span class="p">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">content</span>

<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">'index'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">placeholder</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">ImageForm</span><span class="p">({</span><span class="s">'height'</span><span class="p">:</span><span class="n">height</span><span class="p">,</span><span class="s">'width'</span><span class="p">:</span><span class="n">width</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">form</span><span class="p">.</span><span class="n">is_valid</span><span class="p">():</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="n">generate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s">'/image/png'</span><span class="p">)</span>  
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseBadRequest</span><span class="p">(</span><span class="s">'Invalid image request'</span><span class="p">)</span>

</code></pre></div></div><hr /> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/placeholder_image_server/" > <div class="nav-arrow">Previous</div> <span class="post-title">Django - Placeholder Image Server : First Steps</span> </a> <a class="post-nav-item post-nav-next" href="/Placeholder-Image-Server-Adding-Caching/"> <div class="nav-arrow">Next</div> <span class="post-title">Django - Placeholder Image Server : Adding Caching</span> </a> </nav> <footer class="footer"> Made by <a href="https://github.com/seifallahhomrani1" target="_blank" rel="noreferrer noopener" >Seif-Allah</a> <span class="footer_item">&copy; 2021</span> <small class="footer_copyright"> </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
